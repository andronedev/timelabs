{{> dashboard_navbar}}

<div class="mt-2">
    <div class="box has-background-light">
        <h3 class="title is-3">Timelaps #<b>{{timelaps.id}}</b> <span class="tag is-info is-medium">État : <b>{{timelaps.status}}</b></span></h3>

        <a class="button is-primary is-medium" href="/dashboard/timelaps/{{timelaps.id}}/raw" download="timelaps.mp4">
            Télécharger
        </a>

        <a class="button is-danger is-medium" href="/dashboard/timelaps/{{timelaps.id}}/delete">
            Supprimer
        </a>

        <a class="button is-info is-medium" href="#logs">
            Afficher les logs
        </a>
    </div>
    

    <div class="box">
        <h3 class="title is-3">Rendu :</h3>
        {{#if done}}
        <video controls>
            <source src="/dashboard/timelaps/{{timelaps.id}}/stream" type="video/mp4" />
        </video>
        {{else}}
        <div class="has-text-centered">
            <h1 class="title is-1">En cours de création</h1>
            <h3 class="title is-3">Merci de patienter..</h3>
            <h2 class="subtitle is-3">{{timelaps.status}}</h2>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                style="margin: auto; background: rgba(0, 0, 0, 0) none repeat scroll 0% 0%; display: block; shape-rendering: auto;"
                width="200px" height="200px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
                <circle cx="50" cy="50" r="32" stroke-width="8" stroke="#000000"
                    stroke-dasharray="50.26548245743669 50.26548245743669" fill="none" stroke-linecap="round">
                    <animateTransform attributeName="transform" type="rotate" dur="1s" repeatCount="indefinite"
                        keyTimes="0;1" values="0 50 50;360 50 50"></animateTransform>
                </circle>
                <circle cx="50" cy="50" r="23" stroke-width="8" stroke="#b0b0b0"
                    stroke-dasharray="36.12831551628262 36.12831551628262" stroke-dashoffset="36.12831551628262"
                    fill="none" stroke-linecap="round">
                    <animateTransform attributeName="transform" type="rotate" dur="1s" repeatCount="indefinite"
                        keyTimes="0;1" values="0 50 50;-360 50 50"></animateTransform>
                </circle>
                <!-- [ldio] generated by https://loading.io/ -->
            </svg>
        </div>
        {{/if}}

    </div>
    <div class="box">
        <h3 class="title is-3">Logs :</h3>
        <pre><code id="logs">{{timelaps.logs}}</code></pre>
    </div>
</div>
<script>
    function getInfos() {
        fetch('/dashboard/timelaps/{{timelaps.id}}/infos')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                if (!data.done) {
                    document.getElementById('logs').innerText = data.logs;
                    setTimeout(getInfos, 200);
                } else {
                    window.location.reload();
                }
            });
    }
    if (!({{ done }})) {
        getInfos();
    }
</script>